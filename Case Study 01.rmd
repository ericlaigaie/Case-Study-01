---
title: "Case Study - 01"
author: "Eric Laigaie"
date: "10/5/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
rm(list = ls())
library(tidyverse)
library(readr)
library(ggplot2)
library(choroplethr)
library(choroplethrMaps)
library(ggpubr)
```

```{r}
# Load in Both Beers and Breweries datasets.
beers <- read_csv(url("https://raw.githubusercontent.com/ericlaigaie/Case-Study-01/main/Beers.csv?token=AL7L5SUDXIN5C6OJ62LPMELBLTXMC"))
breweries <- read_csv(url("https://raw.githubusercontent.com/ericlaigaie/Case-Study-01/main/Breweries.csv?token=AL7L5SSPZ7B6NQBXJIMILGDBLTXOM"))
```

1.   How many breweries are present in each state?
```{r State n, fig.height=5}
# Brewery Bar Chart
breweries %>%
  group_by(State) %>%
  mutate(n = n()) %>%
  ggplot(aes(x=n, y=reorder(State, n))) + 
  geom_bar(stat='identity', fill='darkseagreen4') + 
  labs(x='State', y='Number of Breweries', title='Number of Breweries by State') + 
  theme_minimal()

# Load in State Brewery Counts (This changes State name from "AL" -> "alabama")
states <- read_csv("C:\\Users\\ericl\\OneDrive\\Desktop\\SMU\\Doing Data Science - FALL 2021\\Case Study 01\\state_brewery_counts.csv")

# Import geojson for state polygons
data(continental_us_states)

# Designate region & value
states$region <- tolower(states$State)
states$value <- states$n

# Create Choropleth
state_choropleth(states, 
                 num_colors=9,
                 zoom = continental_us_states) +
  scale_fill_brewer(palette="Greens") +
  labs(title = "Breweries by State",
       fill = "n") +
  guides(fill=guide_legend(title="N"))
```

2.   Merge beer data with the breweries data. Print the first 6 observations and the last six observations to check the merged file.  (RMD only, this does not need to be included in the presentation or the deck.)
```{r}
# Merge beers and breweries
breweries <- breweries %>% rename(Brewery_id=Brew_ID)
df <- merge(breweries, beers, by='Brewery_id')

df <- df %>% rename(Brewery = Name.x, Beer = Name.y)

# Print top & bottom 6
head(df, 6)
tail(df, 6)
```

3.   Address the missing values in each column.
```{r}
# METHOD 1 - REMOVE ALL

# Print all columns and # of NA's
#sapply(df, function(x) sum(is.na(x)))

# Remove all NA's
#df <- na.omit(df)
```

```{r}
# METHOD 2 - EQUALS ZERO

# Set NA ABV's and IBU's to 0
df$ABV[is.na(df$ABV)] = 0
df$IBU[is.na(df$IBU)] = 0

# Show that remaining NA's are in 'Style'
sum(is.na(df))
sum(is.na(df$Style))

# Remove 5 missing 'Styles'
df = na.omit(df)
```

4.   Compute the median alcohol content and international bitterness unit for each state. Plot a bar chart to compare.
```{r med_abv, fig.height=5}
# Median ABV bar chart
df %>% group_by(State) %>% 
  summarise(med_abv = median(ABV)) %>%
  ggplot(aes(y=reorder(State, med_abv), x=med_abv)) + 
  geom_bar(stat='identity', fill='darkseagreen4') +
  labs(x='Median ABV', y='State', title='Median ABV by State')

# Median IBU bar chart
df %>% group_by(State) %>%
  summarise(med_ibu = median(IBU)) %>%
  ggplot(aes(y=reorder(State, med_ibu), x=med_ibu)) + 
  geom_bar(stat='identity', fill='darkseagreen4') +
  labs(x='Median IBU', y='State', title='Median IBU by State')
```

5.   Which state has the maximum alcoholic (ABV) beer? Which state has the most bitter (IBU) beer?
```{r}
# Find max ABV & IBU
max_ABV = max(df$ABV)
max_IBU = max(df$IBU)
df %>% filter(ABV == max_ABV)
df %>% filter(IBU == max_IBU)
```

6.   Comment on the summary statistics and distribution of the ABV variable.
```{r}
# Quick summary of ABV - full dataset
summary(df$ABV)
sd(df$ABV)

# Make new df 'alc' <- only contains values with positive ABV
alc <- df %>% filter(ABV > 0)

# Quick summary of ABV - only alcoholic beers
summary(alc$ABV)
sd(alc$ABV)

# Make 4 charts
box_all <- ggplot(df, aes(x=ABV)) + geom_boxplot(binwidth=.01, fill='darkseagreen4') + 
  labs(x='ABV', title='ABV Boxplot')
box_alc <- ggplot(alc, aes(x=ABV)) + geom_boxplot(binwidth=.01, fill='darkseagreen3') + 
  labs(x='ABV', title='ABV Boxplot (Only ABV > 0)')
hist_all <- ggplot(df, aes(x=ABV)) + geom_histogram(color='black', fill='darkseagreen4') +
  labs(x='ABV', title='ABV Histogram')
hist_alc <- ggplot(alc, aes(x=ABV)) + geom_histogram(color='black', fill='darkseagreen3') +
  labs(x='ABV', title='ABV Histogram (Only ABV > 0)')

# Arrange 4 charts
ggarrange(box_all, box_alc, hist_all, hist_alc, nrow=2, ncol=2)
```

7.   Is there an apparent relationship between the bitterness of the beer and its alcoholic content? Draw a scatter plot.  Make your best judgment of a relationship and EXPLAIN your answer.
```{r}
# Find correlation of IBU and ABV in df
cor_IBUABV = round(cor(df$IBU, df$ABV), 3)

# Make R label
label_x = paste(c("R =", cor_IBUABV), collapse = " ")

# IBU and ABV scatterplot (with R label)
ggplot(df, aes(x=IBU, ABV)) + 
  geom_point(size=2, color='darkseagreen3') + 
  geom_smooth(method='lm', color='darkseagreen4') +
  labs(x='International Bittering Units (IBU)', y='Alcohol by Volume (ABV)', title='IBU vs ABV') +
  geom_label(label=label_x, x=100, y=.025,label.padding = unit(0.55, "lines"), label.size = 0.35, color = "black", fill="#69b3a2")

# Make new df, df_alc, which contains rows with IBU > 0 and ABV > 0
df_alc <- df %>%
  filter(IBU > 0 & ABV > 0)

# Find correlation of IBU and ABV in df_alc
cor_alcIBUABV = round(cor(df_alc$IBU, df_alc$ABV), 3)

# Make R label
label_y = paste(c("R = ", cor_alcIBUABV), collapse = " ")

# IBU and ABV scatterplot (From df_alc, with R label)
ggplot(df_alc, aes(y=ABV,x=IBU)) + 
  geom_point(size=2, color='darkseagreen3') + 
  geom_smooth(method='lm',color='darkseagreen4') + 
  labs(x='International Bittering Units (IBU)', y='Alcohol by Volume (ABV)', title='IBU vs ABV (IBU & ABV > 0)') +
  geom_label(label=label_y, x=100, y=0.035,label.padding = unit(0.55, "lines"), label.size = 0.35, color = "black", fill="#69b3a2")
```

8.  Budweiser would also like to investigate the difference with respect to IBU and ABV between IPAs (India Pale Ales) and other types of Ale (any beer with “Ale” in its name other than IPA).  You decide to use KNN classification to investigate this relationship.  Provide statistical evidence one way or the other. You can of course assume your audience is comfortable with percentages … KNN is very easy to understand conceptually.
```{r}

```

In addition, while you have decided to use KNN to investigate this relationship (KNN is required) you may also feel free to supplement your response to this question with any other methods or techniques you have learned.  Creativity and alternative solutions are always encouraged.
```{r}

```

9. Knock their socks off!  Find one other useful inference from the data that you feel Budweiser may be able to find value in.  You must convince them why it is important and back up your conviction with appropriate statistical evidence.
```{r}

```

